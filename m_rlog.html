<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />




<title></title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/readable.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<link href="site_libs/ionicons-2.0.1/css/ionicons.min.css" rel="stylesheet" />

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>




<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 66px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 71px;
  margin-top: -71px;
}
.section h2 {
  padding-top: 71px;
  margin-top: -71px;
}
.section h3 {
  padding-top: 71px;
  margin-top: -71px;
}
.section h4 {
  padding-top: 71px;
  margin-top: -71px;
}
.section h5 {
  padding-top: 71px;
  margin-top: -71px;
}
.section h6 {
  padding-top: 71px;
  margin-top: -71px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->



<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_').toLowerCase();
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}


.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
  padding-left: 25px;
  text-indent: 0;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-inverse  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Tutoriel R</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="interface.html">
    <span class="ion ion-android-expand"></span>
     
    Demarrer
  </a>
</li>
<li>
  <a href="basicbuilding.html">0. Les bases</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    1. Les données
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="importer2.html">Formats</a>
    </li>
    <li>
      <a href="importer.html">Importer/Sauvegarder</a>
    </li>
    <li>
      <a href="g_variables.html">Modifier les données</a>
    </li>
  </ul>
</li>
<li>
  <a href="v_quanti.html">2. Decrire</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    3. Analyser
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="compa_univ.html">Comparaisons</a>
    </li>
    <li>
      <a href="m_lineaire.html">Modele lineaire</a>
    </li>
    <li>
      <a href="m_rlog.html">Regression logistique</a>
    </li>
    <li>
      <a href="m_surv.html">Modele de survie</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">




</div>


<style>
  h1{
    font-size: 25px !important;
    color: #FFFFFF !important;
    border-style: solid;
    border-color: #4582EC;
    background-color: #4582EC;
    text-align: center;
  }
</style>
<style>
  h2{
    font-size: 25px !important;
    color: #4582EC !important;
    border-style: solid;
    border-color: #4582EC;
    text-align: center;
  }
</style>
<style>
  h3{
    font-size: 25px !important;
    color: #FFFFFF !important;
    border-style: solid;
    border-color: #982727;
    background-color: #982727;
    text-align: center;
  }
</style>
<style>
  h4{
    font-size: 25px !important;
    color: #FFFFFF !important;
    border-style: solid;
    border-color: #0F9D58;
    background-color: #0F9D58;
    text-align: center;
  }
</style>
<style>
  h5{
    font-size: 25px !important;
    color: #FFFFFF !important;
    border-style: solid;
    border-color: #F4B400;
    background-color: #F4B400;
    text-align: center;
  }
</style>
<h4>
Synthèse
</h4>
<ul>
<li>Une régression logistique permet de décrire la relation entre une variable expliquée qualitative, binaire, et une ou plusieurs variables explicatives.<br />
</li>
<li>La fonction glm() permet de paramètrer le modèle que l’on aura réfléchi au préalable.</li>
</ul>
<h1>
Principe du test
</h1>
<p>Le principe générale est similaire à celui des modèles linéaires. On souhaite comprendre la relation d’une variable, cette fois catégorielle, binaire, avec une ou plusieurs autres variables.</p>
<p>On cherche à expliquer une variable dichotomique dont les valeurs sont donc soient 0, soient 1.<br />
Pour modéliser cela on utilise la fonction <a href="https://en.wikipedia.org/wiki/Sigmoid_function">sigmoïde</a>:</p>
<p><span class="math display">\[S(x)=\frac{e^{\alpha + \beta * x}}{1+ e^{\alpha + \beta * x}}\]</span></p>
<p>On cherche à déterminer les paramètres <span class="math inline">\(\alpha\)</span> et <span class="math inline">\(\beta\)</span> qui définissent le modèle en optimisant un critère statistique: <a href="https://mistis.inrialpes.fr/software/SMEL/cours/ep/node11.html">la vraisemblance</a>.<br />
Elle représente la probabilité que les observations que l’on fait soient issues d’une distribution théorique donnée.</p>
<p>Pour chaque valeurs de paramètres du modèle on peut définir une vraisemblance. Parmi toutes les vraisemblances possibles, il existe une valeur maximale. Cette valeur maximale permet d’identifier les paramètres du modèle qui ont les plus grande probabilité d’expliquer nos données.</p>
<p><em>Sur la figure suivante on représente les valeurs de X (continue) en fonction du groupe défini par Y (binaire). On trace différentes fonctions logistiques, correspondant à différentes valeurs de paramètres. Le modèle présentant la vraisemblance maximale (ici la plus proche de 0) est celui dont les paramètres sont jugés optimaux. La probabilité d’observer les données, si elles étaient issues de ce modèle, est plus élevée que pour des modèles présentant d’autres paramètres.</em></p>
<div class="figure">
<img src="Gif_rl.gif" />

</div>
<p><em>Sur la figure suivante, on observe la vraisemblance (axe z) calculé selon différents couples d’intercept et de coefficients (axes x et y). Le maximum de vraisemblance indique un couple de valeurs que l’on considérera comme optimal.</em></p>
<iframe width="500" height="400" frameborder="0" scrolling="no" src="//plot.ly/~Benjamin_Landre/3.embed">
</iframe>
<pre class="r"><code># La combinaison présentant la vraisemblance la plus grande
Resu[which.max(Resu$LogVrai),c(1,4)]</code></pre>
<pre><code>##    Alpha: intercept Beta: coefficient
## 56     -0.001694346          2.188529</code></pre>
<pre class="r"><code># Les paramètres identifiés par le modèle
fit</code></pre>
<pre><code>## 
## Call:  glm(formula = y ~ x, family = &quot;binomial&quot;)
## 
## Coefficients:
## (Intercept)            x  
##   -0.001694     2.188529  
## 
## Degrees of Freedom: 99 Total (i.e. Null);  98 Residual
## Null Deviance:       112.5 
## Residual Deviance: 55.89     AIC: 59.89</code></pre>
<h1>
Utilisation dans R
</h1>
<p>La solution directe à partir des fonctions dédiées est la méthode que l’on utilisera en pratique.<br />
La seconde méthode permet de voir et chercher à comprendre les calculs réalisés en arrière plan.</p>
<h2>
Solution directe
</h2>
<p>Les regressions logistiques font partie de la famille des models lineaires generalise.<br />
On specifie juste un lien “binomial” pour preciser un model logistique.</p>
<p>On utilisera la BDD ‘headInjury’, inclus dans le package “DAAG”.<br />
(Pensez a telecharger le package au moins une fois pour utiliser ces donnees: install.package(“DAAG”)).</p>
<p>On souhaite expliquer la gravité d’un traumatisme cranien (high.risk) à partir de la présence de plusieurs signes (vomiting, age.65, amnesia.before, GCS.decrease)</p>
<pre class="r"><code>require(DAAG)
data(&quot;headInjury&quot;)
headInjury$high.risk &lt;- factor(headInjury$high.risk, c(0,1), c(&quot;Low Risk&quot;, &quot;High Risk&quot;))</code></pre>
<pre class="r"><code>RL.1&lt;- glm( formula = high.risk ~ vomiting + age.65 + amnesia.before + GCS.decrease, 
            family = &quot;binomial&quot;, 
            data = headInjury)
summary(RL.1)</code></pre>
<div class="figure">
<img src="rlog_sortie.png" />

</div>
<pre class="r"><code># Pour exprimer les coefficients en odds-ratio
# On utilise la fonction exponentielle &#39;exp()&#39;
exp(RL.1$coefficients)</code></pre>
<pre><code>##    (Intercept)       vomiting         age.65 amnesia.before   GCS.decrease 
##      0.2763634      2.1340021      1.3260726      1.0306283      2.1243153</code></pre>
<pre class="r"><code># Il en est de même pour obtenir les intervals de confiance
exp(confint(RL.1))</code></pre>
<pre><code>## Waiting for profiling to be done...</code></pre>
<pre><code>##                    2.5 %    97.5 %
## (Intercept)    0.2492271 0.3058926
## vomiting       1.6639337 2.7280415
## age.65         1.0342163 1.6904017
## amnesia.before 0.8391808 1.2607844
## GCS.decrease   1.2971597 3.4451123</code></pre>
<h2>
Step by step
</h2>
<p><details> <summary>Pour les curieux - cliquez ICI.</summary></p>
<pre class="r"><code>set.seed(11)

# Mes variables
Y &lt;- as.matrix(c(rep(1, 300), rep(0, 300)))
X &lt;- as.matrix(ifelse(Y == 1, 
                  rnorm(300, 3, 1),
                  rnorm(300,0,1)))



# On ajoute un indice pour évaluer l&#39;intercept du modèle
X &lt;- cbind(rep(1, nrow(X)), X)

# On définit la fonction sigmoide
sigmoid &lt;- function(z)
{
  g &lt;- 1/(1+exp(-z))
  return(g)
}

# On définit la vraisemblance
Vrais. &lt;- function(theta)
{
  m &lt;- nrow(X)
  g &lt;- sigmoid(X%*%theta)
  J &lt;- (1/m)*sum((-Y*log(g)) - ((1-Y)*log(1-g)))
  return(J)
}

# On définit des valeurs initiale des paramètres
# ici 0 pour l&#39;intercept et 0 pour le coefficient
Parametres_initiaux &lt;- rep(0,ncol(X))

# On cherche la valeur qui maximise la vraisemblance
theta_optim &lt;- optim(par= Parametres_initiaux, fn= Vrais.)

# Les paramètres obtenus
theta_optim$par</code></pre>
<pre><code>## [1] -4.808933  3.066462</code></pre>
<pre class="r"><code># Ceux obtenus par la fonction de base
glm(Y ~ X[,-1], family = &#39;binomial&#39;)</code></pre>
<pre><code>## 
## Call:  glm(formula = Y ~ X[, -1], family = &quot;binomial&quot;)
## 
## Coefficients:
## (Intercept)      X[, -1]  
##      -4.809        3.067  
## 
## Degrees of Freedom: 599 Total (i.e. Null);  598 Residual
## Null Deviance:       831.8 
## Residual Deviance: 204.7     AIC: 208.7</code></pre>
<p></details></p>
<h1>
Comparaison de modèles
</h1>
<p>On compare les modèle en comparant leur vraisemblance, en tenant compte du nombre de paramètres estimés.<br />
Des modèles qui ont des vraisemblances équivalentes sont considérés proches. Lorsque les vraisemblances différent on conserve celui qui présente le plus d’information, le modèle le plus complet.</p>
<p>On peut utiliser la fonction anova() qui compare la déviance (-2 log vraisemblance) ou le rapport de vraisemblance lrtest() du package “lmtest”. Les résultats sont identiques.</p>
<p><strong>Pour être valide cette comparaison doit avoir lieu sur des échantillons identiques et dans des modèles emboîtés.</strong></p>
<pre class="r"><code>RL.2&lt;- glm( high.risk ~ vomiting + age.65, family = &quot;binomial&quot;, data=headInjury)

# A partir d&#39;une anova
anova(RL.1, RL.2, test= &quot;Chisq&quot;)</code></pre>
<pre><code>## Analysis of Deviance Table
## 
## Model 1: high.risk ~ vomiting + age.65 + amnesia.before + GCS.decrease
## Model 2: high.risk ~ vomiting + age.65
##   Resid. Df Resid. Dev Df Deviance Pr(&gt;Chi)  
## 1      3116     3407.1                       
## 2      3118     3416.1 -2  -8.9167  0.01158 *
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code># A partir du rapport de vraisemblance
library(lmtest)
lrtest(RL.1, RL.2)</code></pre>
<pre><code>## Likelihood ratio test
## 
## Model 1: high.risk ~ vomiting + age.65 + amnesia.before + GCS.decrease
## Model 2: high.risk ~ vomiting + age.65
##   #Df  LogLik Df  Chisq Pr(&gt;Chisq)  
## 1   5 -1703.6                       
## 2   3 -1708.0 -2 8.9167    0.01158 *
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<h5>
Fonctions sur cette page
</h5>
<table style="width:100%;">
<colgroup>
<col width="30%" />
<col width="69%" />
</colgroup>
<thead>
<tr class="header">
<th>Fonction</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>glm(formula =, data = , family = “binomial”)</td>
<td>renvoi les résultats de la régression logistique</td>
</tr>
<tr class="even">
<td>exp(model$coef)</td>
<td>renvoi les OR de model</td>
</tr>
<tr class="odd">
<td>exp(confint(model))</td>
<td>renvoi les intervals de confiance à 95% du modèle linéaire ‘model’</td>
</tr>
<tr class="even">
<td>anova(model1, model2, test= ‘Chisq’)</td>
<td>renvoi la comparaison des modèles 1 et 2</td>
</tr>
<tr class="odd">
<td>lrtest(model1, model2)</td>
<td>renvoi la comparaison des modèles 1 et 2</td>
</tr>
</tbody>
</table>
<h3>
Pour s’entraîner
</h3>
<p>A venir, un jours.</p>

&nbsp;
<hr />
<p style="text-align: center;"><span style="color: #808080;"><em>benjamin.landre@inserm.fr</em></span></p>

<!-- Add icon library -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

<!-- Add font awesome icons -->
<p style="text-align: center;">
    <a href="https://twitter.com/benjamin_landre" class="fa fa-twitter"></a>
    <a href="https://fr.linkedin.com/in/benjamin-landr%C3%A9-922b1b153" class="fa fa-linkedin"></a>
    <a href="https://github.com/benjamlandre" class="fa fa-github"></a>
</p>

&nbsp;


</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
